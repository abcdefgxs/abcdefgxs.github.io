<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>docker安装elasticsearch（最详细版）</title>
      <link href="2022/02/10/docker-an-zhuang-elasticsearch/"/>
      <url>2022/02/10/docker-an-zhuang-elasticsearch/</url>
      
        <content type="html"><![CDATA[<h1 id="docker安装elasticsearch（最详细版）"><a href="#docker安装elasticsearch（最详细版）" class="headerlink" title="docker安装elasticsearch（最详细版）"></a>docker安装elasticsearch（最详细版）</h1><h2 id="docker安装elasticsearch"><a href="#docker安装elasticsearch" class="headerlink" title="docker安装elasticsearch"></a><a href="https://so.csdn.net/so/search?q=docker">docker</a>安装elasticsearch</h2><h2 id="1-设置max-map-count不能启动es会启动不起来"><a href="#1-设置max-map-count不能启动es会启动不起来" class="headerlink" title="1.设置max_map_count不能启动es会启动不起来"></a>1.设置max_map_count不能启动es会启动不起来</h2><p>查看max_map_count的值 <code>默认是65530</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /proc/sys/vm/max_map_count<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>重新设置max_map_count的值</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sysctl -w vm.max_map_count<span class="token operator">=</span><span class="token number">262144</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-下载镜像并运行"><a href="#2-下载镜像并运行" class="headerlink" title="2.下载镜像并运行"></a>2.下载镜像并运行</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#拉取镜像</span>docker pull elasticsearch:7.7.0<span class="token comment">#启动镜像</span>docker run --name elasticsearch -d -e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms512m -Xmx512m"</span> -e <span class="token string">"discovery.type=single-node"</span> -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 elasticsearch:7.7.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>参数说明</p><pre><code>--name表示镜像启动后的容器名称  -d: 后台运行容器，并返回容器ID；-e: 指定容器内的环境变量-p: 指定端口映射，格式为：主机(宿主)端口:容器端口</code></pre><h2 id="3-浏览器访问ip-9200-如果出现以下界面就是安装成功"><a href="#3-浏览器访问ip-9200-如果出现以下界面就是安装成功" class="headerlink" title="3.浏览器访问ip:9200 如果出现以下界面就是安装成功"></a>3.浏览器访问<code>ip:9200</code> 如果出现以下界面就是安装成功</h2><p><img "" class="lazyload placeholder" data-original="https://img-blog.csdnimg.cn/20201223190232693.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTQyNDkw,size_16,color_FFFFFF,t_70" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="![在这里插入图片描述](https://img-blog.csdnimg.cn/20201223171312149.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTQyNDkw,size_16,color_FFFFFF,t_70"></p><h2 id="4-安装elasticsearch-head"><a href="#4-安装elasticsearch-head" class="headerlink" title="4.安装elasticsearch-head"></a>4.安装<a href="https://so.csdn.net/so/search?q=elasticsearch">elasticsearch</a>-head</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#拉取镜像</span>docker pull mobz/elasticsearch-head:5<span class="token comment">#创建容器</span>docker create --name elasticsearch-head -p <span class="token number">9100</span>:9100 mobz/elasticsearch-head:5<span class="token comment">#启动容器</span>docker start elasticsearch-headordocker start 容器id （docker <span class="token function">ps</span> -a 查看容器id ）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-浏览器打开-http-IP-9100"><a href="#5-浏览器打开-http-IP-9100" class="headerlink" title="5.浏览器打开: http://IP:9100"></a>5.浏览器打开: <code>http://IP:9100</code></h2><p><img "" class="lazyload placeholder" data-original="https://img-blog.csdnimg.cn/20201223171452568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTQyNDkw,size_16,color_FFFFFF,t_70" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="在这里插入图片描述"></p><h2 id="尝试连接easticsearch会发现无法连接上，由于是前后端分离开发，所以会存在跨域问题，需要在服务端做CORS的配置。"><a href="#尝试连接easticsearch会发现无法连接上，由于是前后端分离开发，所以会存在跨域问题，需要在服务端做CORS的配置。" class="headerlink" title="尝试连接easticsearch会发现无法连接上，由于是前后端分离开发，所以会存在跨域问题，需要在服务端做CORS的配置。"></a><code>尝试连接easticsearch会发现无法连接上，由于是前后端分离开发，所以会存在跨域问题，需要在服务端做CORS的配置</code>。</h2><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a><code>解决办法</code></h2><h2 id="6-修改docker中elasticsearch的elasticsearch-yml文件"><a href="#6-修改docker中elasticsearch的elasticsearch-yml文件" class="headerlink" title="6.修改docker中elasticsearch的elasticsearch.yml文件"></a>6.修改docker中elasticsearch的elasticsearch.yml文件</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker <span class="token builtin class-name">exec</span> -it elasticsearch /bin/bash （进不去使用容器id进入）<span class="token function">vi</span> config/elasticsearch.yml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在最下面添加2行</p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">http.cors.enabled: true http.cors.allow-origin: &quot;*&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img "" class="lazyload placeholder" data-original="https://img-blog.csdnimg.cn/20201223171735464.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="在这里插入图片描述"></p><p>退出并重启服务</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">exit</span>docker restart 容器id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img "" class="lazyload placeholder" data-original="http://abc.xslovestudy.com/image-20220103143950753.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20220103143950753"></p><h2 id="7-ElasticSearch-head-操作时不修改配置，默认会报-406错误码"><a href="#7-ElasticSearch-head-操作时不修改配置，默认会报-406错误码" class="headerlink" title="7.ElasticSearch-head 操作时不修改配置，默认会报 406错误码"></a>7.ElasticSearch-head 操作时不修改配置，默认会报 406错误码</h2><pre><code>#复制vendor.js到外部docker cp 55efebc3bc03:/usr/src/app/_site/vendor.js /tmp#修改vendor.jsvim vendor.js</code></pre><p><img "" class="lazyload placeholder" data-original="https://img-blog.csdnimg.cn/20201224103442628.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTQyNDkw,size_16,color_FFFFFF,t_70" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="在这里插入图片描述"><br>修改完成在复制回容器</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker <span class="token function">cp</span> /tmp/vendor.js  55efebc3bc03:/usr/src/app/_site<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>重启elasticsearch-head</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker restart 容器id<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最好就可以查询到es数据了<br><img "" class="lazyload placeholder" data-original="https://img-blog.csdnimg.cn/20201224103651968.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTQyNDkw,size_16,color_FFFFFF,t_70" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="在这里插入图片描述"></p><h2 id="8-安装ik分词器"><a href="#8-安装ik分词器" class="headerlink" title="8.安装ik分词器"></a>8.安装ik分词器</h2><p>这里采用离线安装</p><p>下载分词器压缩包<br>下载地址：</p><p><a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.7.0/elasticsearch-analysis-ik-7.7.0.zip">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.7.0/elasticsearch-analysis-ik-7.7.0.zip</a><br>将IK分词器上传到/tmp目录中（xftp）</p><p>将分词器安装进容器中</p><pre><code>#将压缩包移动到容器中docker cp /tmp/elasticsearch-analysis-ik-7.7.0.zip elasticsearch:/usr/share/elasticsearch/plugins#进入容器docker exec -it elasticsearch /bin/bash  #创建目录mkdir /usr/share/elasticsearch/plugins/ik#将文件压缩包移动到ik中mv /usr/share/elasticsearch/plugins/elasticsearch-analysis-ik-7.7.0.zip /usr/share/elasticsearch/plugins/ik#进入目录cd /usr/share/elasticsearch/plugins/ik#解压unzip elasticsearch-analysis-ik-7.7.0.zip#删除压缩包rm -rf elasticsearch-analysis-ik-7.7.0.zip</code></pre><p>退出并重启镜像</p><p>给大家个建议，这玩意装与不装都挺好，不装查到的东西也很精确够使，装上会查出一些没有用的！</p>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> 后端 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
