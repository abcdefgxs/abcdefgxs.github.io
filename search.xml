<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="2022/01/03/docker-an-zhuang-elasticsearch/"/>
      <url>2022/01/03/docker-an-zhuang-elasticsearch/</url>
      
        <content type="html"><![CDATA[<h1 id="docker安装elasticsearch（最详细版）"><a href="#docker安装elasticsearch（最详细版）" class="headerlink" title="docker安装elasticsearch（最详细版）"></a>docker安装elasticsearch（最详细版）</h1><h2 id="docker安装elasticsearch"><a href="#docker安装elasticsearch" class="headerlink" title="docker安装elasticsearch"></a><a href="https://so.csdn.net/so/search?q=docker">docker</a>安装elasticsearch</h2><h2 id="1-设置max-map-count不能启动es会启动不起来"><a href="#1-设置max-map-count不能启动es会启动不起来" class="headerlink" title="1.设置max_map_count不能启动es会启动不起来"></a>1.设置max_map_count不能启动es会启动不起来</h2><p>查看max_map_count的值 <code>默认是65530</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /proc/sys/vm/max_map_count<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>重新设置max_map_count的值</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sysctl -w vm.max_map_count<span class="token operator">=</span><span class="token number">262144</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-下载镜像并运行"><a href="#2-下载镜像并运行" class="headerlink" title="2.下载镜像并运行"></a>2.下载镜像并运行</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#拉取镜像</span>docker pull elasticsearch:7.7.0<span class="token comment">#启动镜像</span>docker run --name elasticsearch -d -e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms512m -Xmx512m"</span> -e <span class="token string">"discovery.type=single-node"</span> -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 elasticsearch:7.7.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>参数说明</p><pre><code>--name表示镜像启动后的容器名称  -d: 后台运行容器，并返回容器ID；-e: 指定容器内的环境变量-p: 指定端口映射，格式为：主机(宿主)端口:容器端口</code></pre><h2 id="3-浏览器访问ip-9200-如果出现以下界面就是安装成功"><a href="#3-浏览器访问ip-9200-如果出现以下界面就是安装成功" class="headerlink" title="3.浏览器访问ip:9200 如果出现以下界面就是安装成功"></a>3.浏览器访问<code>ip:9200</code> 如果出现以下界面就是安装成功</h2><p><img "" class="lazyload placeholder" data-original="https://img-blog.csdnimg.cn/20201223190232693.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTQyNDkw,size_16,color_FFFFFF,t_70" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="![在这里插入图片描述](https://img-blog.csdnimg.cn/20201223171312149.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTQyNDkw,size_16,color_FFFFFF,t_70"></p><h2 id="4-安装elasticsearch-head"><a href="#4-安装elasticsearch-head" class="headerlink" title="4.安装elasticsearch-head"></a>4.安装<a href="https://so.csdn.net/so/search?q=elasticsearch">elasticsearch</a>-head</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#拉取镜像</span>docker pull mobz/elasticsearch-head:5<span class="token comment">#创建容器</span>docker create --name elasticsearch-head -p <span class="token number">9100</span>:9100 mobz/elasticsearch-head:5<span class="token comment">#启动容器</span>docker start elasticsearch-headordocker start 容器id （docker <span class="token function">ps</span> -a 查看容器id ）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-浏览器打开-http-IP-9100"><a href="#5-浏览器打开-http-IP-9100" class="headerlink" title="5.浏览器打开: http://IP:9100"></a>5.浏览器打开: <code>http://IP:9100</code></h2><p><img "" class="lazyload placeholder" data-original="https://img-blog.csdnimg.cn/20201223171452568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTQyNDkw,size_16,color_FFFFFF,t_70" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="在这里插入图片描述"></p><h2 id="尝试连接easticsearch会发现无法连接上，由于是前后端分离开发，所以会存在跨域问题，需要在服务端做CORS的配置。"><a href="#尝试连接easticsearch会发现无法连接上，由于是前后端分离开发，所以会存在跨域问题，需要在服务端做CORS的配置。" class="headerlink" title="尝试连接easticsearch会发现无法连接上，由于是前后端分离开发，所以会存在跨域问题，需要在服务端做CORS的配置。"></a><code>尝试连接easticsearch会发现无法连接上，由于是前后端分离开发，所以会存在跨域问题，需要在服务端做CORS的配置</code>。</h2><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a><code>解决办法</code></h2><h2 id="6-修改docker中elasticsearch的elasticsearch-yml文件"><a href="#6-修改docker中elasticsearch的elasticsearch-yml文件" class="headerlink" title="6.修改docker中elasticsearch的elasticsearch.yml文件"></a>6.修改docker中elasticsearch的elasticsearch.yml文件</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker <span class="token builtin class-name">exec</span> -it elasticsearch /bin/bash （进不去使用容器id进入）<span class="token function">vi</span> config/elasticsearch.yml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在最下面添加2行</p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml">http.cors.enabled: true http.cors.allow-origin: &quot;*&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img "" class="lazyload placeholder" data-original="https://img-blog.csdnimg.cn/20201223171735464.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="在这里插入图片描述"></p><p>退出并重启服务</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">exit</span>docker restart 容器id<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img "" class="lazyload placeholder" data-original="http://abc.xslovestudy.com/image-20220103143950753.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20220103143950753"></p><h2 id="7-ElasticSearch-head-操作时不修改配置，默认会报-406错误码"><a href="#7-ElasticSearch-head-操作时不修改配置，默认会报-406错误码" class="headerlink" title="7.ElasticSearch-head 操作时不修改配置，默认会报 406错误码"></a>7.ElasticSearch-head 操作时不修改配置，默认会报 406错误码</h2><pre><code>#复制vendor.js到外部docker cp 55efebc3bc03:/usr/src/app/_site/vendor.js /tmp#修改vendor.jsvim vendor.js</code></pre><p><img "" class="lazyload placeholder" data-original="https://img-blog.csdnimg.cn/20201224103442628.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTQyNDkw,size_16,color_FFFFFF,t_70" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="在这里插入图片描述"><br>修改完成在复制回容器</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker <span class="token function">cp</span> /tmp/vendor.js  55efebc3bc03:/usr/src/app/_site<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>重启elasticsearch-head</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker restart 容器id<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最好就可以查询到es数据了<br><img "" class="lazyload placeholder" data-original="https://img-blog.csdnimg.cn/20201224103651968.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwOTQyNDkw,size_16,color_FFFFFF,t_70" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="在这里插入图片描述"></p><h2 id="8-安装ik分词器"><a href="#8-安装ik分词器" class="headerlink" title="8.安装ik分词器"></a>8.安装ik分词器</h2><p>这里采用离线安装</p><p>下载分词器压缩包<br>下载地址：</p><p><a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.7.0/elasticsearch-analysis-ik-7.7.0.zip">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.7.0/elasticsearch-analysis-ik-7.7.0.zip</a><br>将IK分词器上传到/tmp目录中（xftp）</p><p>将分词器安装进容器中</p><pre><code>#将压缩包移动到容器中docker cp /tmp/elasticsearch-analysis-ik-7.7.0.zip elasticsearch:/usr/share/elasticsearch/plugins#进入容器docker exec -it elasticsearch /bin/bash  #创建目录mkdir /usr/share/elasticsearch/plugins/ik#将文件压缩包移动到ik中mv /usr/share/elasticsearch/plugins/elasticsearch-analysis-ik-7.7.0.zip /usr/share/elasticsearch/plugins/ik#进入目录cd /usr/share/elasticsearch/plugins/ik#解压unzip elasticsearch-analysis-ik-7.7.0.zip#删除压缩包rm -rf elasticsearch-analysis-ik-7.7.0.zip</code></pre><p>退出并重启镜像</p><p>给大家个建议，这玩意装与不装都挺好，不装查到的东西也很精确够使，装上会查出一些没有用的！</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>docker安装与基本命令</title>
      <link href="2021/03/10/docker-an-zhuang-yu-ji-ben-ming-ling/"/>
      <url>2021/03/10/docker-an-zhuang-yu-ji-ben-ming-ling/</url>
      
        <content type="html"><![CDATA[<h4 id="一、docker安装"><a href="#一、docker安装" class="headerlink" title="一、docker安装"></a>一、docker安装</h4><p>1.更新yum源。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum -y update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2.安装epel源。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum <span class="token function">install</span> -y epel-release <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>3.清除yum缓存。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum clean all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4.安装并运行Docker。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum <span class="token function">install</span> docker-io -ysystemctl start docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>5.查看docker是否安装成功</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker info<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>6.开放2375端口供外部使用</p><p><code>vim /usr/lib/systemd/system/docker.service</code></p><p>在ExecStart=/usr/bin/dockerd-current 后插入 </p><p><img "" class="lazyload placeholder" data-original="http://abc.xslovestudy.com/clipboard.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></p><ul><li>systemctl daemon-reload <em>// 1，加载docker守护线程</em></li><li> systemctl restart docker  <em>// 2，重启docker</em></li></ul><p>在阿里云的安全组规则里添加2375端口</p><p>7.修改docker默认数据保存位置</p><p><code>vim /usr/lib/systemd/system/docker.service</code></p><p>在ExecStart=/usr/bin/dockerd-current 后插入    –graph /data/docker 修改docker的存储位置为/data/docker</p><p><img "" class="lazyload placeholder" data-original="http://abc.xslovestudy.com/image-20211228134700253.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20211228134700253"></p><ul><li>systemctl daemon-reload <em>// 1，加载docker守护线程</em></li><li> systemctl restart docker  <em>// 2，重启docker</em></li></ul><h4 id="二、docker进程相关的基本命令"><a href="#二、docker进程相关的基本命令" class="headerlink" title="二、docker进程相关的基本命令"></a>二、docker进程相关的基本命令</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl start docker     <span class="token comment">#运行Docker守护进程</span>systemctl stop docker      <span class="token comment">#停止Docker守护进程</span>systemctl restart docker   <span class="token comment">#重启Docker守护进程</span>systemctl <span class="token builtin class-name">enable</span> docker    <span class="token comment">#开机自启动</span>systemctl status docker    <span class="token comment">#查看docker的状态</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="三、镜像相关命令"><a href="#三、镜像相关命令" class="headerlink" title="三、镜像相关命令"></a>三、镜像相关命令</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker pull redis:6.0.12  <span class="token comment"># 拉取redis6.0.12版本的镜像</span>docker rmi c196798056c5  <span class="token comment"># 删除某个镜像</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/03/09/WbT1oD4ENrapyk9.jpg" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif"></p><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="四、docker容器相关命令"><a href="#四、docker容器相关命令" class="headerlink" title="四、docker容器相关命令"></a>四、docker容器相关命令</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker <span class="token function">ps</span>  <span class="token comment"># 查看正在运行的容器</span>docker <span class="token function">ps</span> -a <span class="token comment"># 查看所有容器</span>docker run 参数参数书名-d: 后台运行容器，并返回容器ID；-i: 以交互模式运行容器，通常与 -t 同时使用；-P: 随机端口映射，容器内部端口随机映射到主机的端口-p: 指定端口映射，格式为：主机<span class="token punctuation">(</span>宿主<span class="token punctuation">)</span>端口:容器端口-t: 为容器重新分配一个伪输入终端，通常与 -i 同时使用；--name: 为容器指定名称docker <span class="token builtin class-name">exec</span> -it c1 /bin/bash  <span class="token comment"># 进入c1容器并分配中断</span>docker stop c1 <span class="token comment"># 关闭c1容器</span>docker <span class="token function">rm</span> c1<span class="token punctuation">[</span>容器名称<span class="token operator">|</span>容器id<span class="token punctuation">]</span><span class="token comment"># 删除c1容器</span>docker inspect c1 <span class="token comment"># 查看容器信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># 新建一个容器并指定名称为c1并新建一个模拟终端</span>docker run -it --name<span class="token operator">=</span>c1 centos:7 /bin/bash<span class="token comment"># 在后台创建一个容器</span>docker run -id --name<span class="token operator">=</span>c2 centos:7 /bin/bashdocker run -it --name<span class="token operator">=</span>c3 -v /root/data:/root/data_container centos:7 /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token number">1</span>.创建启动c3数据卷容器，使用-v参数设置数据卷docker run -it --name<span class="token operator">=</span>c3 -v /volume centos:7 /bin/bash<span class="token number">2</span>.创建启动c1、c2容器，使用--volumes-from 参数设置数据卷docker run -it --name<span class="token operator">=</span>c1 --volume-from c3 centos:7 /bin/bashdocker run -it --name<span class="token operator">=</span>c2 --volume-from c3 centos:7 /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="复制运行的容器内部文件"><a href="#复制运行的容器内部文件" class="headerlink" title="复制运行的容器内部文件"></a>复制运行的容器内部文件</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker <span class="token function">cp</span> d8c664a3fe08:/etc/nginx/nginx.conf /root/data/conf/nginx.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="1、docker-安装redis"><a href="#1、docker-安装redis" class="headerlink" title="1、docker 安装redis"></a>1、docker 安装redis</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1.下载redis镜像</span>docker pull redis<span class="token comment"># 2.启动redis并挂载数据卷</span>docker run -d -p <span class="token number">6379</span>:6379 --name myredis -v /root/data/redis/data:/data -v /root/data/redis/redis.conf:/etc/redis/redis.conf redis redis-server /etc/redis/redis.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="五、DockerFile"><a href="#五、DockerFile" class="headerlink" title="五、DockerFile"></a>五、DockerFile</h4><blockquote><p>1.Docker镜像本质是什么？</p><ul><li>是一个分层文件系统。</li></ul><p>2.Docker中一个Centos镜像为什么只有200MB，而一个centos操作系统的ios文件要几个G?</p><ul><li>Centos的ios镜像包含bootfs和rootfs，而docker的centos镜像复用操作系统的bootfs，只有rootfs和其他镜像层。</li></ul><p>3.Docker中一个tomcat镜像为什么有500MB，而一个tomcat安装包只有70多MB？</p><ul><li>由于docker中镜像是分层的，tomcat虽然只有70多MB，但他需要依赖于父镜像和基础镜像，所以整个对外暴露的tomcat镜像大小有500多MB。</li></ul></blockquote><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">镜像制作<span class="token number">1</span>.容器转为镜像docker commit 容器id 镜像名称:版本号docker save -o 压缩文件名称 镜像名称:版本号docker load -i 压缩文件名称<span class="token number">2</span>.dockerfile<span class="token comment"># 将容器转换为镜像</span>docker commit 3db0103dc257 xs_centos:1.0<span class="token comment"># 保存为压缩文件</span>docker save -o xs_centos.tar xs_centos:1.0<span class="token comment"># 恢复镜像</span>docker load -i xs_centos.tar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/03/10/K1Di9IgUr6CNejQ.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="img"></p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/03/10/LjuNzAPYBsE4CWG.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210310221148742" style="zoom:80%;" /><p><img "" class="lazyload placeholder" data-original="https://i.loli.net/2021/03/10/r8fhsGeQypt1Lqm.png" src="https://img10.360buyimg.com/ddimg/jfs/t1/157667/29/9156/134350/603c6445Ebbc9cabe/41219c5d36d45072.gif" alt="image-20210310221409390"></p>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> 后端 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
